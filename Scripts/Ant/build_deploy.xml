<project name="DeployBuild" basedir="." default="main">

	<description>
		Copy the files from the Tomcat lib to the corresponding system directories
	</description>

	<property file="build.properties" /> 
		
	<property name="buildname" value="${buildname}"/>
	<property name="analytics.host.name" value="${analytics.host.name}" />
	<property name="batch.host.name" value="${batch.host.name}" />
	<property name="portal.host.name" value="${portal.host.name}" />
	<property name="reports.host.name" value="${reports.host.name}" />
	<property name="scp.user.name" value="${scp.user.name}" />
	<property name="scp.pwd.name" value="${scp.pwd.name}" />
	<property name="scp.pwd.name1" value="${scp.pwd.name1}" />
	<property name="portal.tomcat.dir" value="${portal.tomcat.dir}" />
	<property name="lib.dir" value="${lib.dir}" />
	<property name="portal.lib.dir" value="${tomcat.dir}/lib" />
	<property name="batch.dir" value="${batch.dir}" />
	<property name="commons.lib.dir" value="${commons.lib.dir}" />
	<property name="business.lib.dir" value="${business.lib.dir}" />
	<property name="analytics.dir" value="${analytics.dir}" />
  	<property name="reports.dir" value="${reports.dir}" />	

	<target name="main" depends="a,b,r" description="Mail, Analytics, Batch, dataAggregator, portal, reports and scpFilesShutdown">
	 
		
	</target>
	
	<target name="down" description="send release mail">
	    <mail 
			mailhost="172.22.1.38" from="neeraj.k@jeanmartin.com" tolist="Abhijitdc@jeanmartin.com,AnandsagarK@jeanmartin.com,gubs@jeanmartin.com,
		    	eswaraiah.sivaiah@jeanmartin.com,ranjab@jeanmartin.com,hemanth@jeanmartin.com,iyappan.padmanabhan@jeanmartin.com,
		    	mathivanan.thanigaivelu@jeanmartin.com,neeraj.k@jeanmartin.com,peter.leslie@jeanmartin.com,prabhakaran.dhakshinamoorthy@jeanmartin.com,
		    	priya@jeanmartin.com,pugalarasan.gunasekaran@jeanmartin.com,radhika.mohandhas@jeanmartin.com,sakthipriya.vairamani@jeanmartin.com,
	    	gubs@jeanmartin.com" subject="[HUDSON]::QA will be down for deployment">
			<replyto address="neeraj.k@jeanmartin.com"/>
			  <message>The ${buildname} build is getting deployed</message>
		   </mail>
	</target>
	
	<target name="up" description="send release mail">
	    <mail 
			mailhost="172.22.1.38" from="neeraj.k@jeanmartin.com" tolist="Abhijitdc@jeanmartin.com,AnandsagarK@jeanmartin.com,gubs@jeanmartin.com,
		    	eswaraiah.sivaiah@jeanmartin.com,ranjab@jeanmartin.com,hemanth@jeanmartin.com,iyappan.padmanabhan@jeanmartin.com,
		    	mathivanan.thanigaivelu@jeanmartin.com,neeraj.k@jeanmartin.com,peter.leslie@jeanmartin.com,prabhakaran.dhakshinamoorthy@jeanmartin.com,
		    	priya@jeanmartin.com,pugalarasan.gunasekaran@jeanmartin.com,radhika.mohandhas@jeanmartin.com,sakthipriya.vairamani@jeanmartin.com,
	    	gubs@jeanmartin.com" subject="[HUDSON]::QA is up with latest build : ${buildname}">
			<replyto address="neeraj.k@jeanmartin.com"/>
			  <message>The ${buildname} build is deployed</message>
		   </mail>
	</target>

	<target name="commons">
		<ant antfile="build_sms_commons.xml" dir="." />
	</target>

	<target name="business">
		<ant antfile="build_sms_business.xml" dir="." />
	</target>
	
	<target name="a" description="Deploy analytics">
		<ant antfile="build_sms_analytics.xml" dir="." />
		
		<!-- analytics -->
		<scp file="${lib.dir}/SMSAnalytics.jar" todir="${scp.user.name}:${scp.pwd.name}@${analytics.host.name}:${analytics.dir}"/>
	</target>
	
	<target name="b" depends="commons,business" description="Deploy Batch">
		<ant antfile="build_sms_batch.xml" dir="." />
		
		<!-- batch -->
		<scp file="${lib.dir}/SMSBatch.jar" todir="${scp.user.name}:${scp.pwd.name1}@${batch.host.name}:${batch.dir}"/>
		<scp file="${lib.dir}/SMSCommons.jar" todir="${scp.user.name}:${scp.pwd.name1}@${batch.host.name}:${commons.lib.dir}"/>
		<scp file="${lib.dir}/SMSBusiness.jar" todir="${scp.user.name}:${scp.pwd.name1}@${batch.host.name}:${business.lib.dir}"/>
		
	</target>
	
	<target name="p" depends="commons,business" description="Deploy Portal">
		<ant antfile="build_sms_web.xml" dir="." />
	</target>

	<target name="r" depends="commons,business" description="deploy reports">
		<ant antfile="build_sms_reports.xml" dir="." />
		
		<!-- reports -->
        <scp file="${lib.dir}/SMSReports.jar" todir="${scp.user.name}:${scp.pwd.name}@${reports.host.name}:${reports.dir}"/>
        <scp file="${lib.dir}/SMSBusiness.jar" todir="${scp.user.name}:${scp.pwd.name}@${reports.host.name}:${business.lib.dir}"/>
        <scp file="${lib.dir}/SMSCommons.jar" todir="${scp.user.name}:${scp.pwd.name}@${reports.host.name}:${commons.lib.dir}"/>
			
	</target>
	
	<target name="da" depends="commons" description="Deploy streamingWeb and Aggregator">
		<ant antfile="build_sms_streamingweb.xml" dir="." />
		<ant antfile="build_sms_aggregator.xml" dir="." />
	</target>
	
	<target name="scpFilesShutdown" description="This target only for scp files">
		
		<!-- portal 
		<scp file="${lib.dir}/SMSWeb.war" todir="${scp.user.name}:${scp.pwd.name}@${portal.host.name}:${portal.tomcat.dir}/webapps"/>
		
		<scp file="${lib.dir}/SMSStreamingWeb.war" todir="${scp.user.name}:${scp.pwd.name}@${batch.host.name}:${portal.tomcat.dir}/webapps"/>
		<scp file="${lib.dir}/SMSDataAggregator.war" todir="${scp.user.name}:${scp.pwd.name}@${batch.host.name}:${portal.tomcat.dir}/webapps"/>  -->
		<!--
		<sshexec host="${reports.host.name}" username="${scp.user.name}" password="${scp.pwd.name}" command="${reports.dir}/stopServer.sh"/>
		<sshexec host="${batch.host.name}" username="${scp.user.name}" password="${scp.pwd.name}" command="${batch.dir}/restart.sh"/> 
		
		
		<sshexec host="${portal.host.name}" username="${scp.user.name}" password="${scp.pwd.name}" command="${portal.tomcat.dir}/bin/shutdown.sh"/>
		<sshexec host="${batch.host.name}" username="${scp.user.name}" password="${scp.pwd.name}" command="${portal.tomcat.dir}/bin/shutdown.sh"/>
		-->
	</target>
		
</project>

